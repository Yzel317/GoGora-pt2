<!--Authors: John Gabriel Pampo, Justine Lucas-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GoGora - Schedule Management</title>
  <link rel="stylesheet" href="admin.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400..700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="script.js" defer></script>
  <link rel="icon" type="image/png" href="/assets/favicon.png">
  <style>
    /* Button alignment */
    .title-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .rides-section, .schedules-section {
      margin-top: 20px;
    }

    .ride-item, .schedule-item {
      border: 1px solid #ddd;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      background-color: #f9f9f9;
    }
    table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            font-size: larger;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #ddd;
        }

    /* Schedule specific styles */
    .schedule-controls {
      position: absolute;
      right: 10px;
      top: 10px;
      display: flex;
      gap: 8px;
    }

    .schedule-modal-content.minimized {
      transform: scale(0.7);
      width: 70%;
      margin-top: 80vh;
      opacity: 0.8;
    }

    .schedule-modal-content.maximized {
      width: 95vw;
      max-width: none;
      height: 90vh;
      margin: 5vh auto;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .add-schedule, .delete-schedule, .download-csv {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .add-schedule {
      background-color: #34A853;
      color: white;
    }

    .delete-schedule {
      background-color: #EA4335;
      color: white;
    }

    .download-csv {
      background-color: #4285F4;
      color: white;
    }

    .schedule-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      margin: 10px 0;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .schedule-item p {
      width: 16%;
      text-align: center;
      margin: 0;
    }

    .status {
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: bold;
    }

    .status.active {
      background-color: #34A853;
      color: white;
    }

    .status.full {
      background-color: #FBBC05;
      color: white;
    }

    .search-filters {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 20px 0;
      padding: 15px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .search-filters input,
    .search-filters select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .search-filters button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #4285F4;
      color: white;
    }

    .search-filters button:last-child {
      background-color: #666;
    }

    #schedules-container {
      max-height: 600px;
      overflow-y: auto;
    }

    .header {
      background-color: #f5f5f5;
      font-weight: bold;
      position: sticky;
      top: 0;
      z-index: 1;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <aside class="sidebar">
      <div class="logo">
        <h2><span style="color: #4285F4;">Go</span><span style="color: #FBBC05;">Go</span><span style="color: #FBBC05;">Ra</span></h2>
      </div>
      <nav>
        <ul class="menu">
          <li><a href="index.html" class="menu-item"><i class="icon">üè†</i> Dashboard</a></li>
          <li><a href="ride_manager.html" class="menu-item"><i class="icon">üõ£Ô∏è</i> Manage Rides</a></li>
          <li><a href="account_manager.html" class="menu-item"><i class="icon">üë•</i> Manage Accounts</a></li>
          <li><a href="statistics.html" class="menu-item"><i class="icon">üìä</i> Statistics</a></li>
          <li><a href="blacklist.html" class="menu-item"><i class="icon">üö´</i> Blacklist Passengers</a></li>
        </ul>
      </nav>
    </aside>
    <main class="main-content">
      <div class="title-section">
        <h1>Manage Schedules</h1>
        <div class="action-buttons">
          <button class="add-schedule" onclick="toggleAddScheduleMode()">Add Schedule</button>
          <button class="delete-schedule" onclick="toggleDeleteMode()">Delete Schedule</button>
          <button class="download-csv" onclick="downloadSchedulesCSV()">Download CSV</button>
        </div>
      </div>

      <div class="search-filters">
        <h3>Search:</h3>
        <input type="text" id="searchInput" placeholder="Search Schedules" oninput="filterSchedules()">
        <h3>Schedule ID:</h3>
        <select id="filterScheduleId">
          <option value="">Filter by Schedule ID</option>
        </select>
        <h3>Route:</h3>
        <select id="filterRoute">
          <option value="">Filter by Route</option>
        </select>
        <h3>Departure:</h3>
        <select id="filterDeparture">
          <option value="">Filter by Departure</option>
        </select>
        <h3>Available Seats:</h3>
        <select id="filterSeatsAvailable">
          <option value="">Filter by Seats</option>
        </select>
        <button onclick="applyFilters()">Apply</button>
        <button onclick="clearFilters()">Clear All</button>
      </div>

      <div class="schedules-section">
        <h2>Active Schedules</h2>
        <div class="schedule-item header">
          <p>Schedule ID</p>
          <p>Ride ID</p>
          <p>Route</p>
          <p>Departure</p>
          <p>Seats Available</p>
          <p>Status</p>
        </div>
        <div id="schedules-container">
          <!-- Sample schedule data -->
          <div class="schedule-item">
            <p>SCH001</p>
            <p>RD105</p>
            <p>Cebu City ‚Üî Mandaue</p>
            <p>2024-03-20 08:00 AM</p>
            <p>15</p>
            <p class="status active">Active</p>
          </div>
          <div class="schedule-item">
            <p>SCH002</p>
            <p>RD108</p>
            <p>Mandaue ‚Üî Lapu-Lapu</p>
            <p>2024-03-20 09:30 AM</p>
            <p>12</p>
            <p class="status active">Active</p>
          </div>
          <div class="schedule-item">
            <p>SCH003</p>
            <p>RD112</p>
            <p>Cebu City ‚Üî Lapu-Lapu</p>
            <p>2024-03-20 10:00 AM</p>
            <p>8</p>
            <p class="status full">Almost Full</p>
          </div>
          <div class="schedule-item">
            <p>SCH004</p>
            <p>RD115</p>
            <p>Cebu City ‚Üî Mandaue</p>
            <p>2024-03-20 11:30 AM</p>
            <p>20</p>
            <p class="status active">Active</p>
          </div>
          <div class="schedule-item">
            <p>SCH005</p>
            <p>RD118</p>
            <p>Mandaue ‚Üî Lapu-Lapu</p>
            <p>2024-03-20 01:00 PM</p>
            <p>5</p>
            <p class="status full">Almost Full</p>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
  // Pretend schedule data array
  const pretendSchedules = [
    {
      schedule_id: 'SCH001',
      ride_id: 'RD105',
      route: 'Cebu City ‚Üî Mandaue',
      departure: '2024-03-20 08:00 AM',
      seats_available: 15,
      status: 'active'
    },
    {
      schedule_id: 'SCH002',
      ride_id: 'RD108',
      route: 'Mandaue ‚Üî Lapu-Lapu',
      departure: '2024-03-20 09:30 AM',
      seats_available: 12,
      status: 'active'
    },
    {
      schedule_id: 'SCH003',
      ride_id: 'RD112',
      route: 'Cebu City ‚Üî Lapu-Lapu',
      departure: '2024-03-20 10:00 AM',
      seats_available: 8,
      status: 'almost_full'
    },
    {
      schedule_id: 'SCH004',
      ride_id: 'RD115',
      route: 'Cebu City ‚Üî Mandaue',
      departure: '2024-03-20 11:30 AM',
      seats_available: 20,
      status: 'active'
    },
    {
      schedule_id: 'SCH005',
      ride_id: 'RD118',
      route: 'Mandaue ‚Üî Lapu-Lapu',
      departure: '2024-03-20 01:00 PM',
      seats_available: 5,
      status: 'almost_full'
    }
  ];

  // Function to display schedules
  function displaySchedules(schedules) {
    const schedulesContainer = document.getElementById('schedules-container');
    schedulesContainer.innerHTML = ''; // Clear the container

    if (schedules.length === 0) {
      schedulesContainer.innerHTML = `<p style="color: gray;">Sorry ü•≤ There are no current schedules available with the information you are looking for ü•≤</p>`;
      return;
    }

    schedules.forEach(schedule => {
      const scheduleItem = document.createElement('div');
      scheduleItem.className = 'schedule-item';
      scheduleItem.innerHTML = `
        <p>${schedule.schedule_id}</p>
        <p>${schedule.ride_id}</p>
        <p>${schedule.route}</p>
        <p>${schedule.departure}</p>
        <p>${schedule.seats_available}</p>
        <p class="status ${schedule.status === 'active' ? 'active' : 'full'}">
          ${schedule.status === 'active' ? 'Active' : 'Almost Full'}
        </p>
      `;
      schedulesContainer.appendChild(scheduleItem);
    });
  }

  // Function to populate filters
  function populateFilters(schedules) {
    const scheduleIds = [...new Set(schedules.map(schedule => schedule.schedule_id))];
    const routes = [...new Set(schedules.map(schedule => schedule.route))];
    const departures = [...new Set(schedules.map(schedule => schedule.departure))];
    const seatsAvailable = [...new Set(schedules.map(schedule => schedule.seats_available.toString()))];

    populateDropdown('filterScheduleId', scheduleIds);
    populateDropdown('filterRoute', routes);
    populateDropdown('filterDeparture', departures);
    populateDropdown('filterSeatsAvailable', seatsAvailable);
  }

  // Helper function to populate dropdown options
  function populateDropdown(selectId, options) {
    const select = document.getElementById(selectId);
    select.innerHTML = '<option value="">All</option>';
    options.forEach(option => {
      const optionElement = document.createElement('option');
      optionElement.value = option;
      optionElement.textContent = option;
      select.appendChild(optionElement);
    });
  }

  // Filter schedules based on search input
  function filterSchedules() {
    const searchInput = document.getElementById('searchInput').value.toLowerCase();
    const filteredSchedules = pretendSchedules.filter(schedule => {
      return (
        schedule.schedule_id.toLowerCase().includes(searchInput) ||
        schedule.ride_id.toLowerCase().includes(searchInput) ||
        schedule.route.toLowerCase().includes(searchInput) ||
        schedule.departure.toLowerCase().includes(searchInput) ||
        schedule.seats_available.toString().includes(searchInput)
      );
    });
    displaySchedules(filteredSchedules);
  }

  // Apply filters
  function applyFilters() {
    const scheduleId = document.getElementById('filterScheduleId').value;
    const route = document.getElementById('filterRoute').value;
    const departure = document.getElementById('filterDeparture').value;
    const seatsAvailable = document.getElementById('filterSeatsAvailable').value;

    const filteredSchedules = pretendSchedules.filter(schedule => {
      return (
        (scheduleId === "" || schedule.schedule_id === scheduleId) &&
        (route === "" || schedule.route === route) &&
        (departure === "" || schedule.departure === departure) &&
        (seatsAvailable === "" || schedule.seats_available.toString() === seatsAvailable)
      );
    });

    displaySchedules(filteredSchedules);
  }

  // Clear all filters
  function clearFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('filterScheduleId').value = '';
    document.getElementById('filterRoute').value = '';
    document.getElementById('filterDeparture').value = '';
    document.getElementById('filterSeatsAvailable').value = '';
    displaySchedules(pretendSchedules);
  }

  // Download CSV function
  function downloadSchedulesCSV() {
    const headers = ['Schedule ID', 'Ride ID', 'Route', 'Departure', 'Seats Available', 'Status'];
    const csvContent = [
      headers.join(','),
      ...pretendSchedules.map(schedule => [
        schedule.schedule_id,
        schedule.ride_id,
        schedule.route,
        schedule.departure,
        schedule.seats_available,
        schedule.status
      ].join(','))
    ].join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'schedules.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
  }

  // Initialize the page
  document.addEventListener('DOMContentLoaded', () => {
    displaySchedules(pretendSchedules);
    populateFilters(pretendSchedules);
  });
  </script>
</body>
</html>