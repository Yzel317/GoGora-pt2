<!--Authors: John Gabriel Pampo, Justine Lucas-->
<!-- statistics.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GoGora - Ride Statistics</title>
  <link rel="stylesheet" href="admin.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400..700&display=swap" rel="stylesheet">  
  <script src="script.js" defer></script>
  <link rel="icon" type="image/png" href="/assets/favicon.png">
  <style>
    /* Statistics specific styles */
    .chart-container {
      margin: 20px 0;
      padding: 15px;
      border-radius: 8px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stats-controls {
      position: absolute;
      right: 10px;
      top: 10px;
      display: flex;
      gap: 8px;
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }

    .stat-number {
      font-size: 32px;
      font-weight: bold;
      margin: 10px 0;
      color: #4285F4;
    }

    .stat-label {
      color: #666;
    }

    .stats-section {
      margin: 30px 0;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .stats-box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stats-list {
      list-style: none;
      padding: 0;
      margin: 15px 0;
    }

    .stats-list li {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }

    .stats-list li:last-child {
      border-bottom: none;
    }

    .route, .time, .demographic, .rating, .month {
      color: #333;
    }

    .count, .percentage, .amount {
      font-weight: bold;
      color: #4285F4;
    }

    h2 {
      color: #333;
      margin-top: 30px;
    }

    h3 {
      color: #666;
      margin: 0;
    }

    .icon {
      font-size: 24px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <aside class="sidebar">
      <div class="logo">
        <h2><span style="color: #4285F4;">Go</span><span style="color: #FBBC05;">Go</span><span style="color: #FBBC05;">Ra</span></h2>
      </div>
      <nav>
        <ul class="menu">
          <li><a href="index.html" class="menu-item"><i class="icon">üè†</i> Dashboard</a></li>
          <li><a href="ride_manager.html" class="menu-item"><i class="icon">üõ£Ô∏è</i> Manage Rides</a>
          <li><a href="account_manager.html" class="menu-item"><i class="icon">üë•</i> Manage Accounts</a></li>
          <li><a href="statistics.html" class="menu-item"><i class="icon">üìä</i> Statistics</a></li>
          <li><a href="blacklist.html" class="menu-item"><i class="icon">üö´</i> Blacklist Passengers</a></li>
        </ul>
      </nav>
    </aside>
    <main class="main-content">
      <h1>Statistics Overview</h1>
      
      <!-- Revenue Overview -->
      <div class="stats-container">
        <div class="stat-card">
          <i class="icon">üí∞</i>
          <h3>Total Revenue</h3>
          <p class="stat-number">‚Ç±158,234</p>
          <p class="stat-label">This month</p>
        </div>
        <div class="stat-card">
          <i class="icon">üìà</i>
          <h3>Growth Rate</h3>
          <p class="stat-number">+23%</p>
          <p class="stat-label">vs last month</p>
        </div>
        <div class="stat-card">
          <i class="icon">üöó</i>
          <h3>Active Rides</h3>
          <p class="stat-number">42</p>
          <p class="stat-label">Currently ongoing</p>
        </div>
        <div class="stat-card">
          <i class="icon">üë•</i>
          <h3>New Users</h3>
          <p class="stat-number">156</p>
          <p class="stat-label">This week</p>
        </div>
      </div>

      <!-- Ride Statistics -->
      <section class="stats-section">
        <h2>Ride Activity</h2>
        <div class="stats-grid">
          <div class="stats-box">
            <h3>Popular Routes</h3>
            <ul class="stats-list">
              <li>
                <span class="route">Cebu City ‚Üî Mandaue</span>
                <span class="count">324 rides</span>
              </li>
              <li>
                <span class="route">Cebu City ‚Üî Lapu-Lapu</span>
                <span class="count">256 rides</span>
              </li>
              <li>
                <span class="route">Mandaue ‚Üî Lapu-Lapu</span>
                <span class="count">198 rides</span>
              </li>
            </ul>
          </div>
          <div class="stats-box">
            <h3>Peak Hours</h3>
            <ul class="stats-list">
              <li>
                <span class="time">7:00 AM - 9:00 AM</span>
                <span class="count">32% of rides</span>
              </li>
              <li>
                <span class="time">5:00 PM - 7:00 PM</span>
                <span class="count">28% of rides</span>
              </li>
              <li>
                <span class="time">12:00 PM - 2:00 PM</span>
                <span class="count">15% of rides</span>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!-- User Activity -->
      <section class="stats-section">
        <h2>User Activity</h2>
        <div class="stats-grid">
          <div class="stats-box">
            <h3>User Demographics</h3>
            <ul class="stats-list">
              <li>
                <span class="demographic">Students</span>
                <span class="percentage">45%</span>
              </li>
              <li>
                <span class="demographic">Professionals</span>
                <span class="percentage">35%</span>
              </li>
              <li>
                <span class="demographic">Others</span>
                <span class="percentage">20%</span>
              </li>
            </ul>
          </div>
          <div class="stats-box">
            <h3>User Satisfaction</h3>
            <ul class="stats-list">
              <li>
                <span class="rating">5 ‚≠ê</span>
                <span class="percentage">68%</span>
              </li>
              <li>
                <span class="rating">4 ‚≠ê</span>
                <span class="percentage">24%</span>
              </li>
              <li>
                <span class="rating">3 ‚≠ê or below</span>
                <span class="percentage">8%</span>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Monthly Overview -->
      <section class="stats-section">
        <h2>Monthly Overview</h2>
        <div class="stats-grid">
          <div class="stats-box">
            <h3>Revenue Breakdown</h3>
            <ul class="stats-list">
              <li>
                <span class="month">March 2024</span>
                <span class="amount">‚Ç±158,234</span>
              </li>
              <li>
                <span class="month">February 2024</span>
                <span class="amount">‚Ç±128,456</span>
              </li>
              <li>
                <span class="month">January 2024</span>
                <span class="amount">‚Ç±115,789</span>
              </li>
            </ul>
          </div>
          <div class="stats-box">
            <h3>Total Rides</h3>
            <ul class="stats-list">
              <li>
                <span class="month">March 2024</span>
                <span class="count">1,245 rides</span>
              </li>
              <li>
                <span class="month">February 2024</span>
                <span class="count">1,089 rides</span>
              </li>
              <li>
                <span class="month">January 2024</span>
                <span class="count">956 rides</span>
              </li>
            </ul>
          </div>
        </div>
      </section>
    </main>
  </div>
  <script>
    // Fetch statistics and display them
    fetch('/stats')
      .then(response => response.json())
      .then(stats => {
        const tableBody = document.querySelector('#statisticsTable tbody');
        stats.forEach(stat => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${stat.ride_id}</td>
            <td>${stat.time_of_arrival}</td>
            <td>${stat.time_of_departure}</td>
          `;
          tableBody.appendChild(row);
        });
      });

      function downloadStatistics() {
      // Fetch the statistics data from the server
      fetch('/stats')
        .then(response => response.json())
        .then(stats => {
          // Step 1: Convert the data to CSV format
          const headers = ['Ride ID', 'Arrival Time', 'Departure Time'];
          const rows = stats.map(stat => [stat.ride_id, stat.time_of_arrival, stat.time_of_departure]);
          
          // Combine headers and rows into a single CSV string
          const csvContent = [headers, ...rows]
            .map(row => row.join(',')) // Convert each row to comma-separated values
            .join('\n'); // Combine all rows with a newline
        
          // Step 2: Create a Blob for the CSV data
          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        
          // Step 3: Create a temporary link element
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = 'statistics.csv'; // File name for the download
        
          // Step 4: Programmatically click the link to trigger download
          link.click();
        
          // Cleanup: Remove the temporary object URL
          URL.revokeObjectURL(link.href);
        })
        .catch(error => {
          console.error('Error downloading statistics:', error);
          alert('Failed to download statistics.');
        });
    }

  </script>
</body>
</html>
